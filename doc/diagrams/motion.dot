digraph Motion {
    label="Motion Dataflow";

    subgraph cluster_highlevel {
        label="High-level Commands";

        move_cmd [label="move()"];
        pivot_cmd [label="pivot()"];
        pivotTo_cmd [label="pivotTarget()"];
        face_cmd [label="face()"];
        worldVel_cmd [label="worldVel()"];
        stop_cmd [label="stop()"];
    }

    {
        node [color=blue];

        posTarget, velTarget;
        faceTarget, targetAngleVel;
        pivotTarget;
        pivotRate;
    }

    path;

    subgraph cluster_RobotCommand {
        label="Robot Command";

        vel, angleVel;
    }

    {
        node [shape=rect];

        path_constraints [label="startSpeed\nmaxSpeed\nendSpeed\nmaxAccel"];
        angleVel_constraints [label="maxAngleVel\nmaxAngleAcc"];
        path_to_vel_constraints [label="error\nPID"];
        targetAngleVel_to_angleVel_constraints [label="PID"];
    }

    move_cmd -> posTarget;
    pivotTo_cmd -> pivotTarget;
    pivot_cmd -> pivotRate -> {velTarget, angleVel_constraints};
    face_cmd -> {faceTarget};
    worldVel_cmd -> velTarget;
    stop_cmd -> {velTarget, targetAngleVel};


    velTarget -> vel;
    targetAngleVel -> targetAngleVel_to_angleVel_constraints -> angleVel;

    posTarget -> path_constraints -> path;
    path -> path_to_vel_constraints -> vel;

    faceTarget -> angleVel_constraints -> angleVel;

    c [shape=rect, label="maxAngleVel\nmaxAngleAcc"];
    pivotTarget -> c -> {vel, angleVel};
}
